Once m1n1 worked, I wanted to get u-boot going so that I could chainload Linux off the internal drive. Fortunately, someone has already done the work to get NVMe working in u-boot: https://github.com/kettenis/u-boot

I wrote a derivation to build u-boot with the correct configs and glue it to m1n1. Currently it is hardcoded for the M1 Mac Mini 2020, but another device tree can be specified later.

To test it out under the m1n1 hypervisor, you can do something like:
export M1N1DEVICE=/dev/ttyACM0
`nix-build -A m1n1`/bin/m1n1-run_guest `nix-build -A u-boot`/u-boot.macho

Then, in another terminal:
nix-shell -p picocom --run 'picocom /dev/ttyACM1'

and the u-boot console should come up.

The framebuffer still does not work...
