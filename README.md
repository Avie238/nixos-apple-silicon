Attempts to get NixOS up on M1 Macs.

This is mostly a restructuring of work many others have already done, and it wouldn't have been possible without them.
